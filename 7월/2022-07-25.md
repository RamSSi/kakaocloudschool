# Servlet

## Internet
- #### Network of Network â–¶ infrastructure

## TCP/IP
- ë°ì´í„° ì „ì†¡ â–¶ íŒ¨í‚·(Packet) ë‹¨ìœ„ë¡œ ì „ì†¡ë¨
### IP : ì»´í“¨í„°-ì»´í“¨í„° ê°„ ë°ì´í„°(íŒ¨í‚·) ì „ì†¡ì— ì‚¬ìš©ë˜ëŠ” í”„ë¡œí† ì½œ
- ë¹„ì‹ ë¢°ì„± : íŒ¨í‚·ì˜ ì„±ê³µì ì¸ ì „ì†¡, ìˆœì„œê°€ ë³´ì¥ë˜ì§€ ì•ŠìŒ
- ë¹„ì—°ê²°ì„± 

### TCP(Transmission control protocol)
- ë°ì´í„° ì „ì†¡ ì œì–´ í”„ë¡œí† ì½œ
- IP í”„ë¡œí† ì½œì„ ë³´ì™„í•˜ì—¬ ì‹ ë¢°ì„± ìˆëŠ” ë°ì´í„° ì „ì†¡ì„ ê°€ëŠ¥í•˜ê²Œ í•¨

### IP Address
- DNS (Domain Name System, Domain Name Server)
    - ìˆ«ìë¡œ êµ¬ì„±ëœ IP ì£¼ì†Œë¥¼ Domain Nameìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í”„ë¡œì„¸ìŠ¤
    
### Port
- í”„ë¡œì„¸ìŠ¤ì— í• ë‹¹ë˜ëŠ” ì£¼ì†Œ, ë…¼ë¦¬ì  ìˆ«ì
- NICì— ì¡´ì¬í•˜ëŠ” ì—¬ëŸ¬ ê°œì˜ í”„ë¡œì„¸ìŠ¤ì— ê°ê° ê³ ìœ  Portë²ˆí˜¸ê°€ í• ë‹¹ë¨ 

### Hypertext
- ì‚¬ìš©ìì˜ ì„ íƒì— ë”°ë¼ ê´€ë ¨ëœ ì •ë³´ ìª½ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ì¡°ì§í™”ëœ ì •ë³´
- WWW(World Wide Web)ì˜ ë°œëª…, ë°œì „ì˜ ê³„ê¸°

### HTTP
- Hypertext í†µì‹ ì— ì í•©
- Client-Server êµ¬ì¡° : í•˜ë‚˜ì˜ Server(Web Server)ê°€ ë‹¤ìˆ˜ì˜ Client(ë³´í†µ Browser)ì— serviceí•˜ëŠ” êµ¬ì¡°

<br><br>

>
### Static Web
: Program ì—†ì´ Web Serverê°€ Clientì—ì„œ ìš”ì²­í•œ resourceë¥¼ ì œê³µ

ì„œë²„ê°€ ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ë¥¼ ì¼ë°©ì ìœ¼ë¡œ ì œê³µí•˜ê¸°ë³´ë‹¤ëŠ” ì„œë²„ì—ê²Œ í”„ë¡œê·¸ë¨ ì‹¤í–‰ í›„ ê²°ê³¼ë¥¼ ìš”ì²­í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€í™”í•¨

>
### Dynamic Web
: Server sideì— Programì´ ì¡´ì¬ (Servlet)
- Servlet : ë™ì ìœ¼ë¡œ HTML Page ìƒì„± 
â–¶ Servlet(Java)ì™€ ì›¹ í˜ì´ì§€(HTML, CSS, JS)ì˜ ì‚¬ìš© ì–¸ì–´ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ìƒì‚°ì„±, ìœ ì§€ë³´ìˆ˜ì„± ğŸ”½

Servletì˜ ë‹¨ì ì„ ë³´ì™„í•˜ëŠ” í”„ë¡œê·¸ë¨ ê°œë°œ

>
### JSP
: ìƒì‚°ì„±ì„ ë†’ì´ê¸° ìœ„í•´ ì‚¬ìš©
â–¶ êµ¬í˜„ì€ ì‰½ì§€ë§Œ ìœ ì§€ë³´ìˆ˜ì„± ğŸ”½ 

JSPì˜ ë‹¨ì ìœ¼ë¡œ ì¸í•´ Servletìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ì˜¤ë˜ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„

>
### MVC Pattern
: Layered Architecture ë°©ì‹ì˜ Servlet
â–¶ ì‚¬ìš© ê¸°ë²•ë“¤ì˜ í†µì¼ì„± ë¶€ì¡±

Patternë“¤ê°„ ê·œì¹™ì„ ë§Œë“¤ì–´ í†µì¼ì„±ì„ ì–»ê¸° ìœ„í•œ í”„ë ˆì„ì›Œí¬ ê°œë°œ

>
### Framework
: Spring


<br><br>


# HTTP Client-Server êµ¬ì¡°



#### Tomcat ì—°ë™

![](https://velog.velcdn.com/images/ramu/post/0b9fa78f-f2bb-4b25-a6f9-72e7918d7f6d/image.png)![](https://velog.velcdn.com/images/ramu/post/8c122055-1773-4ae8-86cf-2c220f954106/image.png)![](https://velog.velcdn.com/images/ramu/post/adb2285a-21e9-4d3f-a804-187cd8564ce3/image.png)


## Request
1) Web Client ì¸¡ë©´
>
Request URL : http://localhost:8080/path/file?_______
			  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;í”„ë¡œí† ì½œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IP   &nbsp;&nbsp;&nbsp;  í¬íŠ¸ë²ˆí˜¸
?___ : Query String (?key1=value1&key2=value2&key3=value3)


2) Web Server ì¸¡ë©´
>
### HTTP Request Message
- Request Line: <strong>&lt;HTTP Method&gt; &lt;URL&gt; HTTP/1.1</strong>
- Request Header
  - Clientì˜ IP
  - ì‚¬ìš©ì–¸ì–´ : ko(Acomp-language)
  - content-type
- Request Body: Query Stringì˜ ì •ë³´


- HTTP Method : Clientê°€ Serverë¡œ Requestë¥¼ ë³´ë‚´ëŠ” ë°©ì‹)

<br>


## Response
>
HTTP Response Message
- Response Line(status) : HTTP/1.1(Protocol ë²„ì „) 200(status code) OK(status ì„¤ëª…)
- Response Header: Message size, ë°ì´í„° íƒ€ì… ë“± Response bodyì— ê´€í•œ ì •ë³´
  - Encoding
  - Content-type : MIME(HTTP, image, video ë“±..)
  - body size
  - Server description
- Response Body
  - Requestí•œ íŒŒì¼ì„ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ê²Œ ì „ë‹¬ â–¶ ë¸Œë¼ìš°ì €ê°€ Response Bodyë¥¼ parsingí•˜ì—¬ rendering
  
<br><br>

# Dynamic web project
- Project ì´ë¦„ : eclipseì—ì„œ projectë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•œ ì´ë¦„
- context root : ìš°ë¦¬ projectê°€ clientì— ì˜í•´ ì§€ì¹­ë˜ëŠ” ì´ë¦„ (ìš°ë¦¬ projectì˜ webìƒì—ì„œ ì‚¬ìš©ë˜ëŠ” ë…¼ë¦¬ì ì¸ ì´ë¦„)

![](https://velog.velcdn.com/images/ramu/post/c5da22ad-353b-4797-a210-e74113a7dfb1/image.png)![](https://velog.velcdn.com/images/ramu/post/450dae48-8de2-441b-981c-85b5da2deeae/image.png)

-  projectë¥¼ ìƒì„±í•˜ê³  ì½”ë“œ êµ¬í˜„
    - Web Serverì—ê²Œ ìš°ë¦¬ projectì˜ ì¡´ì¬ë¥¼ ì•Œë ¤ì£¼ì–´ì•¼ í•¨ â–¶ Configured
    - Web Serverë¥¼ í†µí•´ì„œ ìš°ë¦¬ Projectë¥¼ Webì— Deploy
    
![](https://velog.velcdn.com/images/ramu/post/499f1fe4-8523-473f-8e03-6a37420b2d32/image.png)

<br>

## Browserì—ì„œ URLì„ ì´ìš©í•´ Requestë¥¼ ë³´ëƒ„
> http://localhost:8080/html/index.html
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context root ìš”ì²­ resource(ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ index.html)

![](https://velog.velcdn.com/images/ramu/post/89b9c32a-1754-4eb1-a159-06e498249824/image.png)![](https://velog.velcdn.com/images/ramu/post/29e105de-01da-4091-82ef-764f759978c4/image.png)

<br>

## ê°„ë‹¨í•œ static web application êµ¬í˜„
- HTML (íƒœê·¸, ì†ì„±) â–¶ Form (ì‚¬ìš©ì ì…ë ¥ ì–‘ì‹) : Clientê°€ Serverì— Dataë¥¼ ì „ë‹¬í•  ëª©ì ìœ¼ë¡œ ì‚¬ìš©
- CSS
- Javascript

![](https://velog.velcdn.com/images/ramu/post/67a7e833-23c7-4b44-8ed5-d41d4ac8c8e8/image.png)![](https://velog.velcdn.com/images/ramu/post/f7207ef0-f04b-49dc-94e9-d5bdd85fc1f6/image.png)


<br><br>


# Client â–¶ Server
### &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Request
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ì‚¬ìš©ì ë°ì´í„°ë¥¼ í¬í•¨

<br>

## Request Method
### "GET"
>: Query String ì´ìš©

- Browser ì£¼ì†Œì°½ì— URL ì…ë ¥
- Hypertext(ë§í¬)ë¥¼ ì´ìš©í•´ì„œ Request
- Form tag ì´ìš© â–¶ methodê°€ GETì¸ ê²½ìš° formì„ ì´ìš©í•´ request

<br>

### "POST"
>: Query Stringì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  request headerì— ë°ì´í„° í¬í•¨

- Form tag ì´ìš© â–¶ methodê°€ POSTì¸ ê²½ìš° formì„ ì´ìš©í•´ request



#### Query String
- ì¥ì  : ê°„ë‹¨
- ë‹¨ì  : 
    - URLì— ë°ì´í„°ê°€ ë…¸ì¶œ (ë³´ì•ˆ)
    - ëŒ€ëŸ‰ ë°ì´í„° ì „ì†¡ ë¶ˆê°€ëŠ¥

<br><br>

# Dynamic Web <span style="color: blue">(Servlet)</span>
![](https://velog.velcdn.com/images/ramu/post/bb28c30b-f8a4-48f4-a1a5-af7c08e06f3a/image.png)![](https://velog.velcdn.com/images/ramu/post/4f697e91-028b-45f1-b526-bb90f9ca5e61/image.png)![](https://velog.velcdn.com/images/ramu/post/79356cd5-6054-44a3-952d-de700c772d8d/image.png)

- URL mapping : Clientê°€ Server Program(Servlet)ì„ ì‹ë³„í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„
![](https://velog.velcdn.com/images/ramu/post/72785c52-486f-4dbb-a44a-399be1a8a871/image.png)

![](https://velog.velcdn.com/images/ramu/post/18e1d8de-9973-443a-9937-d78873b8df59/image.png)


<br><br><br>


# Servlet ì‘ë™ ì›ë¦¬
1) Web Client(Browser)ê°€ Web Server(HTTP Server)ì—ê²Œ Request(Servlet í˜¸ì¶œ)
2) Web ServerëŠ” Web Container(Servlet Container[Servlet Engine])ì—ê²Œ Servlet ìš”ì²­
- Servlet ìš”ì²­ì€ Request ê°ì²´ë¡œ ë§Œë“¤ì–´ì ¸ Servlet Containerë¡œ ì „ë‹¬ë¨
- Ex. /hello

3) Web Container ë‚´ì— ìš”ì²­ëœ Servlet ê°ì²´ê°€ ìˆëŠ”ì§€ í™•ì¸ (Container ë‚´ì— ê°ì²´ë¡œ ì €ì¥ë¨)
4) í•´ë‹¹ Servletì´ ì—†ìœ¼ë©´ Servlet ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ” Classê°€ ìˆëŠ”ì§€ í™•ì¸
5) Threadê°€ ìƒì„±ë¨
6) ThreadëŠ” Request, Response ìƒì„±í•´ service()ì— ì „ë‹¬í•˜ì—¬ í˜¸ì¶œ
- service() : doGet(), doPost()

Servletì€ Threadì˜ ê³µìš©ê°ì²´ì„

[ê·¸ë¦¼ 11]

<br><br>


![](https://velog.velcdn.com/images/ramu/post/e85fe22b-aa2e-4d93-9dab-f70b90a969b6/image.png)![](https://velog.velcdn.com/images/ramu/post/91d111d1-be1f-4d32-aa5f-7de264cae343/image.png)


## Request ì²˜ë¦¬ ë°©ë²•
![](https://velog.velcdn.com/images/ramu/post/32f4d5d0-4e24-4e76-9d29-e0e0fc9cf28a/image.png)![](https://velog.velcdn.com/images/ramu/post/6534aa60-e16b-4310-abd3-315ce1a8f189/image.png)

- HTMLì˜ &lt;input&gt; íƒœê·¸ì˜ 'name' ì†ì„±ì´ parameter(key)ê°€ ëœë‹¤.
- ì…ë ¥ì„ ë°›ì„ ë•Œ ì‚¬ìš©ë˜ëŠ” Streamì˜ encoding : ISO-8859-1
í•œê¸€ ë°ì´í„°ë¥¼ ì „ë‹¬ë°›ìœ¼ë ¤ë©´ ë°ì´í„° ê°€ê³µ í•„ìš”

>
#### 1) GET ë°©ì‹ : Tomcatì˜ InputStream Encoding ë³€ê²½![](https://velog.velcdn.com/images/ramu/post/6326f35b-40e7-40c1-9942-79b92a85cf23/image.png)
#### 2) POST ë°©ì‹ : ```request.setCharacterEncoding("EUC-KR");```


<br><br>

# Servletì˜ ë™ì‘
## ë¬¸ì œì 

- Layered Architectureì˜ ì ìš© í•„ìš” â–¶ MVC Pattern
- Servletê°„ì˜ ë°ì´í„° ê³µìœ  ë°©ë²• ì—†ìŒ (í•˜ë‚˜ì˜ Servletì´ ì²˜ë¦¬í•œ ê²°ê³¼ë¥¼ ë‹¤ë¥¸ Servletì—ì„œ ì‚¬ìš©í•  ë°©ë²•ì´ ì—†ìŒ)
- ê²°ê³¼ì— ëŒ€í•œ ì¶œë ¥ì˜ ì–´ë ¤ì›€ (Java code ë‚´ì—ì„œ HTMLì„ í¬í•¨ì‹œì¼œì•¼ í•¨) 
â–¶ JSP, Front-endì˜ ìì²´ ì²˜ë¦¬(json) 
- HTTML Protocolì€ <strong style="color: red">Stateless protocol</strong> : Clientì˜ í–‰ì ì„ ì§€ì†ì ìœ¼ë¡œ Trackingí•  ìˆ˜ ì—†ìŒ


## Servlet Context
[ê·¸ë¦¼ 13]
> 
ëª¨ë“  Servletë“¤ì´ ê³µìœ í•˜ëŠ” Map List í˜•íƒœì˜ ê°ì²´
Context Root ì•ˆì— Servlet Context ê°ì²´ëŠ” í•˜ë‚˜!


### Servlet ê°„ì˜ ë°ì´í„° ê³µìœ 


- #### A Servlet : "product"ë¼ëŠ” keyë¡œ "ëƒ‰ì¥ê³ "ë¼ëŠ” ë°ì´í„°(value)ë¥¼ Servlet Contextì— ì €ì¥

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	// 1. ì…ë ¥
		
	// 2. ë¡œì§
	// Servlet Context ì‚¬ìš©
	// ServletContext ê°ì²´ë¥¼ ì–»ì–´ì˜¨ë‹¤. (ê³µìœ ê°ì²´ì— ëŒ€í•œ Referenceë¥¼ íšë“)
	ServletContext context = getServletContext();
		
	// ServletContextì— íŠ¹ì • ì •ë³´ë¥¼ ì €ì¥
	context.setAttribute("product", "ëƒ‰ì¥ê³ ");
		
		
	// 3. ì¶œë ¥
}
```

- #### B Servlet : Servlet Contextì—ì„œ "product"ë¼ëŠ” keyë¥¼ ì´ìš©í•˜ì—¬ ì–»ì€ dataë¥¼ ì¶œë ¥

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	// 1. ì…ë ¥
	// 2. ë¡œì§
	ServletContext context = getServletContext();
	String product = (String)context.getAttribute("product");	// getAttribute(key)ì˜ ê²°ê³¼ Objectë¡œ ë°˜í™˜ë˜ê¸° ë•Œë¬¸ì— downcasting í•„ìš”
		
	// 3. ì¶œë ¥
	response.setContentType("text/html; charset=UTF-8");
	PrintWriter out = new PrintWriter(response.getOutputStream());
	out.println("ì–»ì–´ì˜¨ ê²°ê³¼ëŠ” : " + product);
		
	out.close();
	
}
```
![](https://velog.velcdn.com/images/ramu/post/3b7f3c99-d2de-4786-9152-21f834c50695/image.png)![](https://velog.velcdn.com/images/ramu/post/0fe8f4e7-7bd1-42a6-bcc4-d9a976ec7d6a/image.png)


## HTTP Protocol : Stateless Protocol
> <h3>"Session ì²˜ë¦¬"ë¥¼ í†µí•´ í•´ê²°</h3>

[ê·¸ë¦¼ 14]

1) Web Clientê°€ Web Serverì—ê²Œ Request
2) Web Serverê°€ Servlet Containerì—ê²Œ Request
3) Clientê°€ ì›í•˜ëŠ” Servletì´ ê°€ì§€ê³  ìˆëŠ” ë©”ì†Œë“œ(doGet, doPost)ë¥¼ Threadê°€ ì‹¤í–‰
4) í•´ë‹¹ ë©”ì†Œë“œì—ì„œ session ì²˜ë¦¬
5) Servlet Container ë‚´ì— Session ê°ì²´ê°€ ìƒì„±ë¨ (map í˜•íƒœì˜ ì €ì¥ ê³µê°„, Session idê°€ í• ë‹¹ë¨)
6) ì²˜ë¦¬ëœ ê²°ê³¼ì™€ Session idê°€ í•¨ê»˜ Web Clientì—ê²Œ Responseë¡œ ì „ë‹¬ë¨


- #### SessionTestServlet.java : sessionì„ í• ë‹¹ë°›ì•„ session id ì €ì¥

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	// 1. ì…ë ¥
	String id = request.getParameter("myID");
		
	// 2. Logic
	// í•´ë‹¹ Clientì—ê²Œ sessionì„ í• ë‹¹í•˜ê±°ë‚˜ í• ë‹¹ëœ sessionì„ ì°¾ëŠ”ë‹¤.
		
	HttpSession session = request.getSession();	// containerë¡œë¶€í„° sessionì„ í• ë‹¹ë°›ìŒ
	session.setAttribute("id", id);	// sessionì— id ì €ì¥
				
	// 3. ì¶œë ¥
}
```

- #### UseSessionServlet.java : sessionì— ì €ì¥ëœ í•´ë‹¹ Clientì˜ session idë¥¼ ì¶œë ¥

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	// 1. ì…ë ¥
	// 2. Logic
	HttpSession session = request.getSession();
	String result = (String)session.getAttribute("id");	// sessionìœ¼ë¡œë¶€í„° client idë¥¼ ê°€ì ¸ì˜¨ë‹¤.
		
	// 3. ì¶œë ¥
	response.setContentType("text/html; charset=UTF-8");
	PrintWriter out = new PrintWriter(response.getOutputStream());
	out.println("ì–»ì–´ì˜¨ ê²°ê³¼ëŠ” : " + result);
		
	out.close();
}
```
![](https://velog.velcdn.com/images/ramu/post/b5378705-16a9-4901-8d62-45439516ad80/image.png)![](https://velog.velcdn.com/images/ramu/post/b1dbe0db-d9fb-4bbb-beba-d7287886dfee/image.png)
